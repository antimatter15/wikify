/* Wikify Core
 * (c) Copyright 2008 Antimatter15
 * Prototype 3, Revision 10 Compressed (App Engine Build)
 */
if(!window.Wikify){var Wikify={DOMSnapshot:{},UIFrame:null,DWin:null,getID:function(C){var A=[];while(C!=Wikify.DWin.document.body&&!C.id){for(var B=0;C.parentNode.childNodes[B]!=C;B++){}A.push(B);C=C.parentNode}return[A.reverse(),(C.id?C.id:"_xdby")]},fromID:function(B,A){var C=(A=="_xdby")?Wikify.DWin.document.body:Wikify.DWin.document.getElementById(A);if((B[0]==""&&B.length==1)||!B){return C}while(B.length>0){C=C.childNodes[B.splice(0,1)]}return C},sendData:function(C,E,F){var B=document.createElement("script");var D=document.getElementsByTagName("head")[0];var A=function(){if(F){F()}};B.type="text/javascript";B.src=C+"?"+E;B.onreadystatechange=A;B.onload=A;D.appendChild(B)},capture:function(){var A=Wikify.DWin.document.getElementsByTagName("*"),D={};for(var C=0;C<A.length;C++){if(A[C]!=Wikify.DWin.document.body&&A[C].id.indexOf("firebug")==-1&&A[C].tagName.toLowerCase()!="script"&&A[C].tagName.toLowerCase()!="noscript"&&A[C].tagName.toLowerCase()!="style"&&A[C].tagName.toLowerCase()!="link"&&A[C].tagName.toLowerCase()!="iframe"&&A[C].tagName.toLowerCase()!="br"&&A[C].innerHTML.indexOf("<div")==-1&&A[C].innerHTML.indexOf("<p")==-1&&A[C].innerHTML.indexOf("<span")==-1){try{var B=Wikify.getID(A[C]);D[B[1]+"</,/>"+B[0].join("</,/>")]=A[C].innerHTML}catch(E){}}}return D},diff:function(){var C=Wikify.capture(),B=[];for(var A in C){if(C[A]!=Wikify.DOMSnapshot[A]){B.push(A+"[[]]"+C[A])}}Wikify.DOMSnapshot=C;return B.join("<!!!>")},save:function(){Wikify.setEditable(false);var A=Wikify.diff();if(A!=""){Wikify.setEditable(false);setTimeout(function(){Wikify.setEditable(false);Wikify.sendData(Wikify_Config.saveurl,"url="+escape(window.location.href)+"&dat="+escape(escape(A)))},100)}else{return true}},load:function(){Wikify.setEditable(false);Wikify.sendData(Wikify_Config.loadurl,"url="+escape(window.location.href)+"&ck="+escape(Math.round(Math.random()*99999).toString()))},parse:function(F){F=unescape(F);var A=F.split("<!!!>");for(var C=0;C<A.length;C++){try{var E=A[C].split("[[]]"),B=E[0].split("</,/>");Wikify.fromID(B.slice(1),B[0]).innerHTML=E[1]}catch(D){}}},setEditable:function(A){if(!Wikify.DWin){return }if(A==true){Wikify.DWin.document.designMode="on";Wikify.DWin.document.body.contentEditable=true}else{if(A==false){Wikify.DWin.document.designMode="off";Wikify.DWin.document.body.contentEditable=false}}},createUI:function(){var B=document.getElementsByTagName("html")[0].innerHTML;document.body.innerHTML="";var F=document.createElement("iframe");F.setAttribute("style","border:0;position:absolute;left: 0;top:0;width:100%;height:100%;background-color:#fff");F.width="100%";F.height="100%";F.frameborder="0";document.body.appendChild(F);F=(F.contentWindow)?F.contentWindow:(F.contentDocument.document)?F.contentDocument.document:F.contentDocument;F.document.open();F.document.write(B.replace(/script/g,"noscript")+"<script>window.top.Wikify.load();<\/script>");F.document.close();Wikify.DWin=F;var D="",A={Save:"javascript:Wikify.uisave()",Update:"javascript:Wikify.uiload()",About:"javascript:Wikify.uiabout()",Help:"javascript:Wikify.uihelp()"};for(var C in A){D+='<a style="text-decoration:none;color:#fff" href="'+A[C]+'">'+C+"</a> "}var E=document.createElement("div");E.setAttribute("style","width: 280px; height: 25px; position: absolute; top: 0; right: 0; background-color: #0099FF; font: 16px 'Times New Roman'");document.body.bgcolor="#0099FF";document.body.style.backgroundColor="#0099FF";E.innerHTML='<span style="left:0;position:absolute"><span style="color:#FFFF00">&nbsp;Wikify&nbsp;-&nbsp;</span><span id="Wikify_Status" style="color:#66FF00">Loaded</span></span><span style="right:3px;position:absolute">'+D+"</span>";document.body.appendChild(E)},status:function(A){document.getElementById("Wikify_Status").innerHTML=A},uisave:function(){Wikify.status("Saving");if(Wikify.save()==true){Wikify.uisaved()}},uisaved:function(){Wikify.status("Saved");Wikify.setEditable(true)},uiabout:function(){alert("Wikify Bookmarklet Prototype 3, Revision 10\n(C) Antimatter15 2008")},uihelp:function(){alert("Simply run the bookmarklet from any web page. Be warned, it's terribly glitchy, edits won't be stored if they involve deleting an element or if it's in a paragraph with images or other HTML tags in it.")},uiloaded:function(){Wikify.status("Loaded")},uiload:function(){Wikify.status("Loading");Wikify.load()}};if(window.top==window){Wikify.createUI()}};